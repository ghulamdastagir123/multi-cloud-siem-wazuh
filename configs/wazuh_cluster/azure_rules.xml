##########################---------Azure Rules with MITRE ATT&CK------- ##########################

<group name="azure,cloud,compliance,">

  <!-- BASE RULE -->
  <rule id="100100" level="3">
    <decoded_as>azure-filebeat</decoded_as>
    <description>Azure Activity Log</description>
    <group>azure,</group>
  </rule>

  <!-- ADMINISTRATIVE OPERATIONS -->
  <rule id="100101" level="5">
    <if_sid>100100</if_sid>
    <field name="category">Administrative</field>
    <description>Azure Admin: $(operationName)</description>
    <group>azure_admin,pci_dss_10.2,hipaa_164.312.b,nist_800_53_AU.2,</group>
  </rule>

  <!-- SECURITY CATEGORY -->
  <rule id="100102" level="7">
    <if_sid>100100</if_sid>
    <field name="category">Security</field>
    <description>Azure Security Event: $(operationName)</description>
    <group>azure_security,pci_dss_10.6.1,iso_27001_A.12.4.1,gdpr_IV_35.7.d,</group>
  </rule>

  <!-- ALERT CATEGORY -->
  <rule id="100103" level="6">
    <if_sid>100100</if_sid>
    <field name="category">Alert</field>
    <description>Azure Alert: $(operationName)</description>
    <group>azure_alert,soc2_CC7.2,</group>
  </rule>

  <!-- POLICY VIOLATIONS -->
  <rule id="100104" level="8">
    <if_sid>100100</if_sid>
    <field name="category">Policy</field>
    <description>Azure Policy Event: $(operationName)</description>
    <group>azure_policy,compliance,nist_800_53_CM.7,</group>
  </rule>

  <!-- VM OPERATIONS -->
  <rule id="100110" level="6">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.COMPUTE/VIRTUALMACHINES</field>
    <description>Azure VM Operation: $(operationName)</description>
    <group>azure_vm,</group>
  </rule>

  <rule id="100111" level="8">
    <if_sid>100110</if_sid>
    <field name="operationName">WRITE</field>
    <field name="resultType">Accept|Success</field>
    <description>Azure VM Created/Modified</description>
    <mitre>
      <id>T1578.002</id>
    </mitre>
    <group>azure_vm_change,pci_dss_10.2.7,iso_27001_A.12.4.1,gdpr_IV_30.1.g,hipaa_164.312.b,</group>
  </rule>

  <rule id="100112" level="10">
    <if_sid>100110</if_sid>
    <field name="operationName">DELETE</field>
    <field name="resultType">Accept|Success</field>
    <description>Azure VM DELETED</description>
    <mitre>
      <id>T1578.003</id>
    </mitre>
    <group>azure_vm_delete,pci_dss_10.2.7,iso_27001_A.12.4.1,soc2_CC6.6,nist_800_53_AU.6,</group>
  </rule>

  <rule id="100113" level="5">
    <if_sid>100110</if_sid>
    <field name="operationName">START|RESTART|DEALLOCATE</field>
    <description>Azure VM Power State Changed: $(operationName)</description>
    <mitre>
      <id>T1578.002</id>
    </mitre>
    <group>azure_vm_power,pci_dss_10.2.5,</group>
  </rule>

  <!-- STORAGE OPERATIONS -->
  <rule id="100120" level="7">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.STORAGE/STORAGEACCOUNTS</field>
    <description>Azure Storage Operation: $(operationName)</description>
    <group>azure_storage,pci_dss_10.2,iso_27001_A.12.4.1,</group>
  </rule>

  <rule id="100121" level="10">
    <if_sid>100120</if_sid>
    <field name="operationName">LISTKEYS|REGENERATEKEY</field>
    <description>Azure Storage Keys Accessed</description>
    <mitre>
      <id>T1552.001</id>
    </mitre>
    <group>azure_secrets,pci_dss_10.2.2,pci_dss_3.4,hipaa_164.312.a.2.IV,nist_800_53_AC.2,soc2_CC6.1,</group>
  </rule>

  <rule id="100122" level="9">
    <if_sid>100120</if_sid>
    <field name="operationName">DELETE</field>
    <field name="resultType">Accept|Success</field>
    <description>Azure Storage Account DELETED</description>
    <mitre>
      <id>T1485</id>
    </mitre>
    <group>azure_storage_delete,pci_dss_10.2.7,iso_27001_A.12.4.1,</group>
  </rule>

  <!-- NETWORK SECURITY -->
  <rule id="100130" level="8">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.NETWORK/NETWORKSECURITYGROUPS</field>
    <description>Azure NSG Modified: $(operationName)</description>
    <mitre>
      <id>T1562.007</id>
    </mitre>
    <group>azure_nsg,firewall,pci_dss_1.1.1,pci_dss_1.1.6,iso_27001_A.13.1.1,nist_800_53_SC.7,</group>
  </rule>

  <rule id="100131" level="10">
    <if_sid>100130</if_sid>
    <field name="operationName">SECURITYRULES/WRITE|SECURITYRULES/DELETE</field>
    <description>Azure NSG Rule Changed - Firewall Modification</description>
    <mitre>
      <id>T1562.007</id>
    </mitre>
    <group>azure_firewall_change,pci_dss_1.1.6,nist_800_53_SC.7,soc2_CC6.6,</group>
  </rule>

  <rule id="100132" level="7">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.NETWORK/PUBLICIPADDRESSES</field>
    <description>Azure Public IP Modified: $(operationName)</description>
    <mitre>
      <id>T1562.007</id>
    </mitre>
    <group>azure_network,pci_dss_1.2,</group>
  </rule>

  <!-- SQL DATABASE -->
  <rule id="100140" level="7">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.SQL</field>
    <description>Azure SQL Operation: $(operationName)</description>
    <group>azure_sql,database,pci_dss_10.2.5,hipaa_164.312.b,</group>
  </rule>

  <rule id="100141" level="10">
    <if_sid>100140</if_sid>
    <field name="operationName">FIREWALLRULES</field>
    <description>Azure SQL Firewall Modified</description>
    <mitre>
      <id>T1562.007</id>
    </mitre>
    <group>azure_sql_firewall,pci_dss_1.2.1,nist_800_53_SC.7,iso_27001_A.13.1.1,</group>
  </rule>

  <rule id="100142" level="9">
    <if_sid>100140</if_sid>
    <field name="operationName">DELETE</field>
    <description>Azure SQL Database DELETED</description>
    <mitre>
      <id>T1485</id>
    </mitre>
    <group>azure_sql_delete,pci_dss_10.2.7,hipaa_164.312.b,iso_27001_A.12.3.1,</group>
  </rule>

  <!-- KEY VAULT -->
  <rule id="100150" level="9">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.KEYVAULT</field>
    <description>Azure Key Vault Access: $(operationName)</description>
    <mitre>
      <id>T1555</id>
    </mitre>
    <group>azure_keyvault,secrets,pci_dss_3.4,pci_dss_3.5,hipaa_164.312.a.2.IV,nist_800_53_SC.12,iso_27001_A.10.1.1,</group>
  </rule>

  <rule id="100151" level="10">
    <if_sid>100150</if_sid>
    <field name="operationName">SECRETS/READ|SECRETS/LIST</field>
    <description>Azure Key Vault Secret Accessed</description>
    <mitre>
      <id>T1555</id>
      <id>T1552.001</id>
    </mitre>
    <group>azure_secrets_access,pci_dss_3.4,soc2_CC6.1,</group>
  </rule>

  <rule id="100152" level="11">
    <if_sid>100150</if_sid>
    <field name="operationName">DELETE</field>
    <description>Azure Key Vault DELETED - Critical</description>
    <mitre>
      <id>T1485</id>
      <id>T1490</id>
    </mitre>
    <group>azure_keyvault_delete,pci_dss_10.2.7,iso_27001_A.12.4.1,</group>
  </rule>

  <!-- RBAC & IAM -->
  <rule id="100160" level="8">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.AUTHORIZATION/ROLEASSIGNMENTS</field>
    <description>Azure Role Assignment: $(operationName)</description>
    <mitre>
      <id>T1098</id>
    </mitre>
    <group>azure_rbac,iam,pci_dss_7.1,pci_dss_7.2,iso_27001_A.9.2.1,nist_800_53_AC.2,hipaa_164.308.a.3,soc2_CC6.1,</group>
  </rule>

  <rule id="100161" level="11">
    <if_sid>100160</if_sid>
    <field name="operationName">WRITE</field>
    <field name="resultType">Accept|Success</field>
    <description>Azure Role Assigned - Privilege Change</description>
    <mitre>
      <id>T1098</id>
      <id>T1078.004</id>
    </mitre>
    <group>azure_privilege_escalation,pci_dss_7.1.2,iso_27001_A.9.2.3,soc2_CC6.2,</group>
  </rule>

  <rule id="100162" level="10">
    <if_sid>100160</if_sid>
    <field name="operationName">DELETE</field>
    <description>Azure Role Removed</description>
    <mitre>
      <id>T1098</id>
    </mitre>
    <group>azure_rbac_delete,pci_dss_7.2.3,</group>
  </rule>

  <!-- DIAGNOSTIC SETTINGS (Log Tampering) -->
  <rule id="100170" level="8">
    <if_sid>100101</if_sid>
    <field name="operationName">DIAGNOSTICSETTINGS</field>
    <description>Azure Diagnostic Settings Modified</description>
    <mitre>
      <id>T1562.008</id>
    </mitre>
    <group>azure_monitoring,log_tampering_risk,pci_dss_10.5.2,iso_27001_A.12.4.1,</group>
  </rule>

  <rule id="100171" level="11">
    <if_sid>100170</if_sid>
    <field name="operationName">DELETE</field>
    <description>Azure Diagnostic Settings DELETED - Log Tampering</description>
    <mitre>
      <id>T1562.008</id>
    </mitre>
    <group>azure_critical,log_deletion,pci_dss_10.5.2,nist_800_53_AU.9,soc2_CC7.2,</group>
  </rule>

  <!-- FAILED OPERATIONS -->
  <rule id="100180" level="7">
    <if_sid>100100</if_sid>
    <field name="resultType">Failed|Failure</field>
    <description>Azure Operation Failed: $(operationName)</description>
    <mitre>
      <id>T1078</id>
    </mitre>
    <group>azure_error,authentication_failed,pci_dss_10.2.4,</group>
  </rule>

  <!-- BRUTE FORCE DETECTION -->
  <rule id="100181" level="10" frequency="5" timeframe="300">
    <if_matched_sid>100180</if_matched_sid>
    <same_field>callerIpAddress</same_field>
    <description>Multiple Azure failures from IP: Brute Force Attack</description>
    <mitre>
      <id>T1110</id>
      <id>T1078</id>
    </mitre>
    <group>azure_attack,brute_force,pci_dss_11.4,nist_800_53_SI.4,iso_27001_A.12.4.1,</group>
  </rule>

  <rule id="100182" level="11" frequency="10" timeframe="180">
    <if_matched_sid>100180</if_matched_sid>
    <same_field>callerIpAddress</same_field>
    <description>Rapid Azure failures - Active Attack</description>
    <mitre>
      <id>T1110</id>
      <id>T1078</id>
    </mitre>
    <group>azure_attack,active_attack,soc2_CC7.2,</group>
  </rule>

  <!-- RESOURCE DELETION -->
  <rule id="100190" level="9">
    <if_sid>100101</if_sid>
    <field name="operationName">DELETE</field>
    <field name="resultType">Accept|Success</field>
    <description>Azure Resource Deleted: $(resourceId)</description>
    <mitre>
      <id>T1485</id>
    </mitre>
    <group>azure_deletion,data_loss_risk,pci_dss_10.2.7,iso_27001_A.12.3.1,</group>
  </rule>

  <!-- MASS DELETION -->
  <rule id="100191" level="12" frequency="5" timeframe="300">
    <if_matched_sid>100190</if_matched_sid>
    <description>Mass Deletion Activity - Potential Sabotage</description>
    <mitre>
      <id>T1485</id>
      <id>T1490</id>
    </mitre>
    <group>azure_critical,mass_deletion,insider_threat,soc2_CC6.6,</group>
  </rule>

  <!-- RESOURCE GROUP DELETION -->
  <rule id="100192" level="12">
    <if_sid>100190</if_sid>
    <field name="operationName">RESOURCEGROUPS/DELETE</field>
    <description>Azure Resource Group DELETED - CRITICAL</description>
    <mitre>
      <id>T1485</id>
      <id>T1490</id>
    </mitre>
    <group>azure_critical,mass_deletion,pci_dss_10.2.7,</group>
  </rule>

  <!-- RAPID VM CREATION (Crypto Mining) -->
  <rule id="100200" level="10" frequency="10" timeframe="600">
    <if_matched_sid>100111</if_matched_sid>
    <description>Rapid VM Creation - Resource Abuse/Crypto Mining</description>
    <mitre>
      <id>T1496</id>
      <id>T1578.002</id>
    </mitre>
    <group>azure_abuse,cryptomining_risk,</group>
  </rule>

  <rule id="100210" level="6">
    <if_sid>100101</if_sid>
    <field name="callerIpAddress">\.+</field>
    <description>Azure Activity from IP: $(callerIpAddress)</description>
    <group>azure_external_access,pci_dss_10.2.2,</group>
  </rule>

  <!-- BACKUP OPERATIONS -->
  <rule id="100220" level="6">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.RECOVERYSERVICES</field>
    <description>Azure Backup Operation: $(operationName)</description>
    <group>azure_backup,pci_dss_10.5.3,iso_27001_A.12.3.1,</group>
  </rule>

  <rule id="100221" level="10">
    <if_sid>100220</if_sid>
    <field name="operationName">DELETE</field>
    <description>Azure Backup DELETED - Data Protection Risk</description>
    <mitre>
      <id>T1490</id>
      <id>T1485</id>
    </mitre>
    <group>azure_backup_delete,pci_dss_10.5.3,hipaa_164.308.a.7.ii.A,</group>
  </rule>

  <!-- CONTAINER OPERATIONS -->
  <rule id="100230" level="6">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.CONTAINERSERVICE</field>
    <description>Azure Container/AKS Operation: $(operationName)</description>
    <mitre>
      <id>T1610</id>
    </mitre>
    <group>azure_containers,</group>
  </rule>

  <!-- APP SERVICE -->
  <rule id="100240" level="6">
    <if_sid>100101</if_sid>
    <field name="operationName">MICROSOFT.WEB/SITES</field>
    <description>Azure App Service Operation: $(operationName)</description>
    <group>azure_appservice,</group>
  </rule>

</group>
